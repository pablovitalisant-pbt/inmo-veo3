# Cloud Build para la UI (usa Dockerfile.frontend y despliega a Cloud Run)
steps:
- name: gcr.io/cloud-builders/docker
  args:
  - build
  - '-f'
  - Dockerfile.frontend
  - '--build-arg'
  - VITE_API_BASE=${_VITE_API_BASE}
  - '-t'
  - ${_REGION}-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/inmo-veo3-ui/inmo-veo3-ui:${SHORT_SHA}
  - .
- name: gcr.io/cloud-builders/docker
  args:
  - push
  - ${_REGION}-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/inmo-veo3-ui/inmo-veo3-ui:${SHORT_SHA}
- name: gcr.io/google.com/cloudsdktool/cloud-sdk
  entrypoint: gcloud
  args:
  - run
  - deploy
  - inmo-veo3-ui
  - --image=${_REGION}-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/inmo-veo3-ui/inmo-veo3-ui:${SHORT_SHA}
  - --region=${_REGION}
  - --allow-unauthenticated
  - --platform=managed
  - --timeout=600
substitutions:
  _REGION: 'us-central1'
  _VITE_API_BASE: 'https://inmo-veo3-y25yqmaa3a-uc.a.run.app'
options:
  substitutionOption: ALLOW_LOOSE
images:
- ${_REGION}-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/inmo-veo3-ui/inmo-veo3-ui:${SHORT_SHA}
